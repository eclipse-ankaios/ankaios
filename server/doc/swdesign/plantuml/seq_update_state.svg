<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1005px" preserveAspectRatio="none" style="width:1244px;height:1005px;background:#FFFFFF;" version="1.1" viewBox="0 0 1244 1005" width="1244px" zoomAndPan="magnify"><defs/><g><rect fill="#EEEEEE" height="986.6484" style="stroke:#D3D3D3;stroke-width:0.5;" width="746" x="16" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="110" x="334" y="18.0669">Ankaios Server</text><rect fill="#EEEEEE" height="986.6484" style="stroke:#D3D3D3;stroke-width:0.5;" width="276" x="784" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115" x="864.5" y="18.0669">Ankaios Agents</text><rect fill="#FFFFFF" height="474.5938" style="stroke:#181818;stroke-width:1.0;" width="10" x="71" y="160.9922"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="76" y="557.4531"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="71" y="975.6484"/><rect fill="#FFFFFF" height="315.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="314" y="190.125"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="319" y="242.3906"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="319" y="314.5234"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="319" y="416.9219"/><rect fill="#FFFFFF" height="286.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="499" y="621.5859"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="684.5" y="131.8594"/><rect fill="#FFFFFF" height="21.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="817" y="110.7266"/><rect fill="#FFFFFF" height="65.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="817" y="688.8516"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="822" y="725.9844"/><rect fill="#FFFFFF" height="65.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1017" y="821.25"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="1022" y="858.3828"/><rect fill="none" height="472.5938" style="stroke:#000000;stroke-width:1.5;" width="1227" x="10" y="466.9219"/><rect fill="none" height="118.3984" style="stroke:#000000;stroke-width:1.5;" width="640" x="387" y="650.5859"/><rect fill="none" height="118.3984" style="stroke:#000000;stroke-width:1.5;" width="840" x="387" y="782.9844"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="76" x2="76" y1="72.7266" y2="82.7266"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="76" x2="76" y1="82.7266" y2="110.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="76" x2="76" y1="110.7266" y2="998.6484"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="319" x2="319" y1="72.7266" y2="82.7266"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="319" x2="319" y1="82.7266" y2="110.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="319" x2="319" y1="110.7266" y2="998.6484"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="504" x2="504" y1="72.7266" y2="82.7266"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="504" x2="504" y1="82.7266" y2="110.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="504" x2="504" y1="110.7266" y2="998.6484"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="689" x2="689" y1="72.7266" y2="82.7266"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="689" x2="689" y1="82.7266" y2="110.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="689" x2="689" y1="110.7266" y2="998.6484"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="822" x2="822" y1="72.7266" y2="82.7266"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="822" x2="822" y1="82.7266" y2="110.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="822" x2="822" y1="110.7266" y2="998.6484"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1022" x2="1022" y1="72.7266" y2="82.7266"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1022" x2="1022" y1="82.7266" y2="110.7266"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1022" x2="1022" y1="110.7266" y2="998.6484"/><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="20" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="29.5" y="45.1279">&lt;&lt;thread&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="27" y="61.4248">AnkaiosServer</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="272" y="41.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="279" y="61.4248">ServerState</text><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="214" x="397" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="457.5" y="45.1279">&lt;&lt;thread&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="200" x="404" y="61.4248">GRPCCommunicationsServer</text><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="137" x="621" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="643" y="45.1279">&lt;&lt;thread&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="628" y="61.4248">tonic gRPC server</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="68" x="788" y="41.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="795" y="61.4248">Agent 1</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="68" x="988" y="41.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="995" y="61.4248">Agent 2</text><rect fill="#FFFFFF" height="474.5938" style="stroke:#181818;stroke-width:1.0;" width="10" x="71" y="160.9922"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="76" y="557.4531"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="71" y="975.6484"/><rect fill="#FFFFFF" height="315.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="314" y="190.125"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="319" y="242.3906"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="319" y="314.5234"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="319" y="416.9219"/><rect fill="#FFFFFF" height="286.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="499" y="621.5859"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="684.5" y="131.8594"/><rect fill="#FFFFFF" height="21.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="817" y="110.7266"/><rect fill="#FFFFFF" height="65.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="817" y="688.8516"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="822" y="725.9844"/><rect fill="#FFFFFF" height="65.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1017" y="821.25"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="1022" y="858.3828"/><line style="stroke:#181818;stroke-width:1.0;" x1="695.5" x2="705.5" y1="131.8594" y2="127.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="695.5" x2="705.5" y1="131.8594" y2="135.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="694.5" x2="821" y1="131.8594" y2="131.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="711.5" y="126.7935">UpdateState</text><line style="stroke:#181818;stroke-width:1.0;" x1="82" x2="92" y1="160.9922" y2="156.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="82" x2="92" y1="160.9922" y2="164.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="81" x2="688.5" y1="160.9922" y2="160.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="98" y="155.9263">UpdateState</text><polygon fill="#181818" points="302,186.125,312,190.125,302,194.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="81" x2="308" y1="190.125" y2="190.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="88" y="185.0591">update state</text><line style="stroke:#181818;stroke-width:1.0;" x1="329" x2="371" y1="234.3906" y2="234.3906"/><line style="stroke:#181818;stroke-width:1.0;" x1="371" x2="371" y1="234.3906" y2="247.3906"/><line style="stroke:#181818;stroke-width:1.0;" x1="330" x2="371" y1="247.3906" y2="247.3906"/><polygon fill="#181818" points="340,243.3906,330,247.3906,340,251.3906" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="336" y="214.1919">Compare new with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="336" y="229.3247">old DesiredState</text><line style="stroke:#181818;stroke-width:1.0;" x1="329" x2="371" y1="306.5234" y2="306.5234"/><line style="stroke:#181818;stroke-width:1.0;" x1="371" x2="371" y1="306.5234" y2="319.5234"/><line style="stroke:#181818;stroke-width:1.0;" x1="330" x2="371" y1="319.5234" y2="319.5234"/><polygon fill="#181818" points="340,315.5234,330,319.5234,340,323.5234" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="336" y="301.4575">Validate the new state</text><line style="stroke:#181818;stroke-width:1.0;" x1="329" x2="371" y1="408.9219" y2="408.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="371" x2="371" y1="408.9219" y2="421.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="330" x2="371" y1="421.9219" y2="421.9219"/><polygon fill="#181818" points="340,417.9219,330,421.9219,340,425.9219" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="336" y="373.5903">Update DeleteGraph with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="336" y="388.7231">DeleteConditions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="336" y="403.856">of new workloads</text><path d="M10,466.9219 L74,466.9219 L74,474.0547 L64,484.0547 L10,484.0547 L10,466.9219 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="472.5938" style="stroke:#000000;stroke-width:1.5;" width="1227" x="10" y="466.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="479.9888">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="79" x="89" y="479.1323">[State valid]</text><line style="stroke:#181818;stroke-width:1.0;" x1="82" x2="92" y1="505.1875" y2="501.1875"/><line style="stroke:#181818;stroke-width:1.0;" x1="82" x2="92" y1="505.1875" y2="509.1875"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="81" x2="318" y1="505.1875" y2="505.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="98" y="500.1216">Added and deleted workloads</text><line style="stroke:#181818;stroke-width:1.0;" x1="86" x2="128" y1="549.4531" y2="549.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="128" x2="128" y1="549.4531" y2="562.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="87" x2="128" y1="562.4531" y2="562.4531"/><polygon fill="#181818" points="97,558.4531,87,562.4531,97,566.4531" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="93" y="529.2544">Create FromServer message from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="93" y="544.3872">added and deleted workloads</text><line style="stroke:#181818;stroke-width:1.0;" x1="497" x2="487" y1="621.5859" y2="617.5859"/><line style="stroke:#181818;stroke-width:1.0;" x1="497" x2="487" y1="621.5859" y2="625.5859"/><line style="stroke:#181818;stroke-width:1.0;" x1="81" x2="498" y1="621.5859" y2="621.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="88" y="616.52">send FromServer message</text><line style="stroke:#181818;stroke-width:1.0;" x1="77" x2="87" y1="635.5859" y2="631.5859"/><line style="stroke:#181818;stroke-width:1.0;" x1="77" x2="87" y1="635.5859" y2="639.5859"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="76" x2="498" y1="635.5859" y2="635.5859"/><path d="M387,650.5859 L457,650.5859 L457,657.7188 L447,667.7188 L387,667.7188 L387,650.5859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="118.3984" style="stroke:#000000;stroke-width:1.5;" width="640" x="387" y="650.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="402" y="663.6528">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="214" x="472" y="662.7964">[ExuectionsRequests for Agent 1]</text><line style="stroke:#181818;stroke-width:1.0;" x1="815" x2="805" y1="688.8516" y2="684.8516"/><line style="stroke:#181818;stroke-width:1.0;" x1="815" x2="805" y1="688.8516" y2="692.8516"/><line style="stroke:#181818;stroke-width:1.0;" x1="509" x2="816" y1="688.8516" y2="688.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="516" y="683.7856">send FromServer message</text><line style="stroke:#181818;stroke-width:1.0;" x1="832" x2="874" y1="717.9844" y2="717.9844"/><line style="stroke:#181818;stroke-width:1.0;" x1="874" x2="874" y1="717.9844" y2="730.9844"/><line style="stroke:#181818;stroke-width:1.0;" x1="833" x2="874" y1="730.9844" y2="730.9844"/><polygon fill="#181818" points="843,726.9844,833,730.9844,843,734.9844" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="839" y="712.9185">apply FromServer message</text><path d="M387,782.9844 L457,782.9844 L457,790.1172 L447,800.1172 L387,800.1172 L387,782.9844 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="118.3984" style="stroke:#000000;stroke-width:1.5;" width="840" x="387" y="782.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="402" y="796.0513">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="214" x="472" y="795.1948">[ExuectionsRequests for Agent 2]</text><line style="stroke:#181818;stroke-width:1.0;" x1="1015" x2="1005" y1="821.25" y2="817.25"/><line style="stroke:#181818;stroke-width:1.0;" x1="1015" x2="1005" y1="821.25" y2="825.25"/><line style="stroke:#181818;stroke-width:1.0;" x1="509" x2="1016" y1="821.25" y2="821.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="516" y="816.1841">send FromServer message</text><line style="stroke:#181818;stroke-width:1.0;" x1="1032" x2="1074" y1="850.3828" y2="850.3828"/><line style="stroke:#181818;stroke-width:1.0;" x1="1074" x2="1074" y1="850.3828" y2="863.3828"/><line style="stroke:#181818;stroke-width:1.0;" x1="1033" x2="1074" y1="863.3828" y2="863.3828"/><polygon fill="#181818" points="1043,859.3828,1033,863.3828,1043,867.3828" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="1039" y="845.3169">apply FromServer message</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1237" y1="909.3828" y2="909.3828"/><line style="stroke:#181818;stroke-width:1.0;" x1="77" x2="87" y1="931.5156" y2="927.5156"/><line style="stroke:#181818;stroke-width:1.0;" x1="77" x2="87" y1="931.5156" y2="935.5156"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="76" x2="318" y1="931.5156" y2="931.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="93" y="926.4497">UpdateStateError</text><line style="stroke:#181818;stroke-width:1.0;" x1="76" x2="123" y1="962.6484" y2="962.6484"/><line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="123" y1="962.6484" y2="975.6484"/><line style="stroke:#181818;stroke-width:1.0;" x1="82" x2="123" y1="975.6484" y2="975.6484"/><polygon fill="#181818" points="92,971.6484,82,975.6484,92,979.6484" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="88" y="957.5825">listen for incoming requests</text><!--MD5=[20d452aca3b91dc54732732789e7241d]
@startuml seq_update_state
!include ../../../../resources/doc/plantuml/clean.skin

box "Ankaios Server"
participant "<<thread>>\nAnkaiosServer" as server
participant "ServerState" as server_state
participant "<<thread>>\nGRPCCommunicationsServer" as grpc_server
participant "<<thread>>\ntonic gRPC server" as tonic_server
end box


box "Ankaios Agents"
participant "Agent 1" as agent1
participant "Agent 2" as agent2
end box

activate agent1
...
agent1 ->> tonic_server- -++: UpdateState
tonic_server ->> server- -++: UpdateState
server -> server_state++: update state
server_state -> server_state ++- -: Compare new with\nold DesiredState
server_state -> server_state ++- -: Validate the new state
server_state -> server_state ++- -: Update DeleteGraph with\nDeleteConditions\nof new workloads
alt State valid
server_state - ->> server- -: Added and deleted workloads
server -> server++- -: Create FromServer message from\nadded and deleted workloads
server ->> grpc_server++: send FromServer message
grpc_server - ->> server
deactivate server
opt ExuectionsRequests for Agent 1
grpc_server ->> agent1++:send FromServer message
agent1 -> agent1++- -: apply FromServer message
deactivate agent1
end
opt ExuectionsRequests for Agent 2
grpc_server ->> agent2++:send FromServer message
agent2 -> agent2++- -: apply FromServer message
deactivate agent2
end
deactivate grpc_server
else
server_state - ->> server: UpdateStateError
end
server -> server++: listen for incoming requests


@enduml

@startuml seq_update_state
skinparam monochrome true
skinparam guillemet true
skinparam style strictuml
hide empty members
hide empty methods

skinparam class {
    BorderColor<<logical entity>> grey
    FontColor<<logical entity>> grey
    StereotypeFontColor<<logical entity>> grey
}

skinparam sequenceBox {
    BorderColor #LightGrey
    BackgroundColor #EEEEEE
    FontColor #777777
}

skinparam BoxPadding 10

skinparam note {
    BackgroundColor #FFFFFF
}

skinparam nodesep 30
skinparam ranksep 30

box "Ankaios Server"
participant "<<thread>>\nAnkaiosServer" as server
participant "ServerState" as server_state
participant "<<thread>>\nGRPCCommunicationsServer" as grpc_server
participant "<<thread>>\ntonic gRPC server" as tonic_server
end box


box "Ankaios Agents"
participant "Agent 1" as agent1
participant "Agent 2" as agent2
end box

activate agent1
...
agent1 ->> tonic_server- -++: UpdateState
tonic_server ->> server- -++: UpdateState
server -> server_state++: update state
server_state -> server_state ++- -: Compare new with\nold DesiredState
server_state -> server_state ++- -: Validate the new state
server_state -> server_state ++- -: Update DeleteGraph with\nDeleteConditions\nof new workloads
alt State valid
server_state - ->> server- -: Added and deleted workloads
server -> server++- -: Create FromServer message from\nadded and deleted workloads
server ->> grpc_server++: send FromServer message
grpc_server - ->> server
deactivate server
opt ExuectionsRequests for Agent 1
grpc_server ->> agent1++:send FromServer message
agent1 -> agent1++- -: apply FromServer message
deactivate agent1
end
opt ExuectionsRequests for Agent 2
grpc_server ->> agent2++:send FromServer message
agent2 -> agent2++- -: apply FromServer message
deactivate agent2
end
deactivate grpc_server
else
server_state - ->> server: UpdateStateError
end
server -> server++: listen for incoming requests


@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>